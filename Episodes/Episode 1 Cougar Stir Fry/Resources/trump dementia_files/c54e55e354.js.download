(function($){$(".search-form").on("submit",function(event){event.preventDefault();var searchTerm=$(this).find(".search-term").val();var sectionId=$(this).find(".search-term").data("cid");var keywords=$("meta[name\x3d'news_keywords']").attr("content").split(",");searchUtils.item.regional=keywords[0].replace(/ /g,"-").toLowerCase();var searchFilterSort=$(".pb-f-search-search-filter .filter-form.filter-sort .selected").data("value");var searchFilterType=$(".pb-f-search-search-filter .filter-form.filter-type .selected").data("value");
var cleanSearchUrl=searchUtils.getSearchUrl(searchTerm,null,searchFilterSort,searchFilterType,null,searchUtils.item.regional,sectionId);var refPageElement=$(this).closest("div.form").data("refPageElement");if(refPageElement&&refPageElement!=undefined&&refPageElement.length>0)cs.clickTag(refPageElement,"pv");searchUtils.triggerSearch(cleanSearchUrl)});window.searchUtils=window.searchUtils||{item:{regional:"",query:"",type:"",section:"",sort:"",start:"",filter:"",term:"",c_id:""},refreshItem:function(){searchUtils.item.regional=
$(".pb-f-search-search-filter .filter-form.filter-type").data("regional");searchUtils.item.query=$("#re-search-term").val();searchUtils.item.c_id=$(".search-term:first").data("cid");searchUtils.item.type=$(".pb-f-search-search-filter .filter-form.filter-type .selected").data("value");searchUtils.item.section=$(".pb-f-search-search-filter .filter-form.filter-section .selected").data("value");searchUtils.item.sort=$(".pb-f-search-search-filter .filter-form.filter-sort .selected").data("value");searchUtils.item.start=
$(".pb-f-search-search-pagination .pagination-wrapper").data("start")},allowedRegional:function(region){if(region=="bay-of-plenty-times")return true;else if(region=="rotorua-daily-post")return true;else if(region=="hawkes-bay-today")return true;else if(region=="northern-advocate")return true;else if(region=="wanganui-chronicles")return true;else if(region=="the-country"||region=="rural-business")return true;else if(region=="northland-age")return true;else if(region=="hamilton-news")return true;else if(region==
"aucklander")return true;else if(region=="stratford-press")return true;else if(region=="manawatu-guardian")return true;else if(region=="kapiti-news")return true;return false},getSearchUrl:function(term,start,sort,type,section,regional,c_id){term=term.replace(/ /g,"+");var searchUrl="/search/",paramSpacer="?";var regionalPublication=regional||$(".pb-f-search-search-filter .filter-form.filter-type").data("regional");if(regionalPublication&&regionalPublication.length>0&&searchUtils.allowedRegional(regionalPublication))searchUrl=
searchUrl+regionalPublication+"/";searchUrl=searchUrl+term+"/";if(start&&!(start===undefined)&&start.length>0){searchUrl=searchUrl+paramSpacer+"start\x3d"+start;paramSpacer="\x26"}if(sort&&!(sort===undefined)&&sort.length>0){searchUrl=searchUrl+paramSpacer+"sort\x3d"+sort;paramSpacer="\x26"}var queryString="";if(section&&!(section===undefined)&&section.length>0)if(section!="all"){queryString=queryString+paramSpacer+"section\x3d"+section+",";paramSpacer="\x26"}if(type&&!(type===undefined)&&type.length>
0){if(type=="article")queryString=queryString+paramSpacer+"type\x3darticle";else if(type=="gallery")queryString=queryString+paramSpacer+"type\x3dimage.gallery";else if(type=="video")queryString=queryString+paramSpacer+"type\x3dvideo.other";else queryString=queryString+paramSpacer+"type\x3darticle,image.gallery,video.other";paramSpacer="\x26"}else{queryString=queryString+paramSpacer+"type\x3darticle,image.gallery,video.other";paramSpacer="\x26"}if(c_id&&!(c_id===undefined)&&(c_id.length>0||c_id>0))queryString=
queryString+paramSpacer+"c_id\x3d"+c_id;searchUrl=searchUrl+queryString;this.item.term=queryString;return searchUrl},triggerSearch:function(searchUrl){if(!searchUrl)searchUrl=this.getSearchUrl(this.item.query,this.item.start,this.item.sort,this.item.type,this.item.section,this.item.regional,this.item.c_id);window.location=searchUrl}}})(jQuery);
(function($){var logger=new ARC.Tools.logger("sharebar");var sharebar={initHiddenShares:function(){var stopScrollingMobile=function(e){e.preventDefault();$("body").scrollTop($("body").scrollTop()+1);setTimeout(function(){$("body").scrollTop($("body").scrollTop()-1)},300)};$(".share-container").click(function(){$(this).siblings(".extra-shares").addClass("show-shares");$(this).siblings(".extra-shares")[0].addEventListener("touchmove",stopScrollingMobile,false);$("html, body").addClass("hidden-share-no-scroll")});
$(".extra-shares .share-close").click(function(){$(this).parent().removeClass("show-shares");$("html, body").removeClass("hidden-share-no-scroll");$(this).parent()[0].removeEventListener("touchmove",stopScrollingMobile)})},initBookmark:function(){$(".bookmark").click(function(){if($(this).hasClass("saved"))savedArticles.removeArticle();else{savedArticles.saveArticle();$(this).trigger("save_content")}})},init:function(){this.initHiddenShares();this.initBookmark();$(".social-tools a").on("click",function(){var $this=
$(this);var evenName=$this.find("img").attr("class").split(" ")[0];$this.trigger("share_content",{"name":evenName})})}};sharebar.init();var savedArticles={t:"",saved_id:"",init:function(){if(this.isSignedIn()){if($.cookie("nzh_b_cache")){bookmarkToSave=$.cookie("nzh_b_cache");$.removeCookie("nzh_b_cache",{path:"/",domain:".nzherald.co.nz"});this.saveArticle(bookmarkToSave)}this.checkSaved()}},getUrlParam:function(name){var results=(new RegExp("[?\x26]"+name+"\x3d([^\x26#]*)")).exec(window.location.href);
return results?results[1]:0},isSignedIn:function(){if($.cookie("syncData")){this.t=JSON.parse($.cookie("syncData")).t;return true}else return false},checkSaved:function(){var token=encodeURIComponent(this.t);var data='{"nzh-token":"'+token+'"}';$.ajax({type:"POST",url:"https://secure.nzherald.co.nz/api/SaveForLater/get/",data:data,contentType:"application/json",success:function(data){var currentObjId=savedArticles.getUrlParam("objectid");$(data.data.aUnread).each(function(){if(currentObjId==this.object_id){$(".bookmark").removeClass("svg-bookmark-icon").addClass("saved svg-bookmark-saved-icon");
savedArticles.saved_id=this.id}})},error:function(error){logger.log(error)}})},saveArticle:function(objectId){if(this.isSignedIn()){var token=encodeURIComponent(this.t);var object_id=objectId?objectId:this.getUrlParam("objectid");var object_type="";var data='{"nzh-token":"'+token+'","is_active":"1","object_id":"'+object_id+'","object_type_id":"1"}';$.ajax({type:"POST",url:"https://secure.nzherald.co.nz/api/SaveForLater/save/",data:data,contentType:"application/json",dataType:"text",success:function(data){$(".bookmark").removeClass("svg-bookmark-icon").addClass("saved svg-bookmark-saved-icon");
savedArticles.saved_id=data.split('saved_id":')[1].split("}")[0]},error:function(data){logger.log("Cannot save data")}})}else{var date=new Date;date.setTime(date.getTime()+5*60*1E3);var object_id=this.getUrlParam("objectid");$.cookie("nzh_b_cache",object_id,{expires:date,path:"/",domain:".nzherald.co.nz"});window.location="/account/profile/login/"}},removeArticle:function(){var token=encodeURIComponent(this.t);var saved_id=this.saved_id;var data='{"nzh-token":"'+token+'","is_viewed":"1","saved_id":"'+
saved_id+'"}';$.ajax({type:"POST",url:"https://secure.nzherald.co.nz/api/SaveForLater/mark/",data:data,contentType:"application/json",dataType:"text",success:function(data){$(".bookmark.saved").removeClass("saved svg-bookmark-saved-icon").addClass("svg-bookmark-icon")},error:function(error){logger.log(error)}})}};savedArticles.init()})(jQuery);
(function($){$(".share-button.facebook").click(function(){var picture=$(this).data("original");var url=$(this).data("url");FB.ui({app_id:0x5c78620a78b54,method:"feed",link:$(this).data("url"),picture:$(this).data("original")},function(response){})})})(jQuery);